---
builders:
  - type: vagrant
    communicator: ssh
    source_path: mastoras/ubuntu
provisioners:
  - type: shell
    inline: |
      bash -x -c '
        curl https://omnitruck.chef.io/install.sh |
          sudo bash -s -- -P chef-workstation -c stable -v 0.2.41 &&
        sudo mkdir /local &&
        sudo chmod 777 /local &&
        true 
      '
  - type: file
    source: lib/install-chef-server.bash
    destination: /local/install-chef-server.bash
  - type: shell
    inline: |
      bash -x /local/install-chef-server.bash -- -
  - type: file
    source: lib/config.rb
    destination: /home/vagrant/.chef/config.rb
  - type: shell
    inline: |
      bash -x -c '
        cd /home/vagrant &&
        mkdir cookbooks &&
        cd cookbooks &&
        git clone https://github.com/learn-chef/learn_chef_apache2.git &&
        true
      '
  - type: file
    source: lib/get_pem_keys.bash
    destination: /local/get_pem_keys.bash
